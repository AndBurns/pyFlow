import*as e from"react";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},o={};t.d(o,{A:()=>it});const n=(r={default:()=>e.default,useState:()=>e.useState},i={},t.d(i,r),i);var r,i;function l(e){return null===e?"null":Array.isArray(e)?`[${e.map(l).join(",")}]`:"object"==typeof e?(t=e,`{${Object.keys(t).sort().map((e=>`${e}:${l(t[e])}`)).join(",")}}`):JSON.stringify(e);var t}function s(e,t){const o="FILTER"===e.type,n="FILTER"===t.type;return o&&!n||!o&&n?"FILTER":"DATA"}function u(e,t,o,n){return e.map((e=>{const r=l(e.columnId),i=l(e.rowId);if(!o.has(r))return null;if(!n.has(i))return null;const u=o.get(r),d=n.get(i);return{edit:t.resolve(d,u).edit,cell:e,type:s(u,d)}})).filter((e=>e?.edit))}function d(e,t){return Math.round(e*t)/t}function c(e,t,o){const n=e.state,r=e.canvases[`${t}-${o}`],i=n.sections[t],l=n.sections[o],s=l.columns,u=i.rows,c=n.devicePixelRatio;if(0===u.length||0===s.length)return void(r.parentElement&&r.parentElement.removeChild(r));r.parentElement||e.element.appendChild(r);const a=r.getContext("2d",{alpha:!1}),h=n.scrollRect,f=n.textResolver,p=n.renderFormatResolver,m=n.borderWidth,g=i.showTopBorder,y=i.showBottomBorder,w=l.showLeftBorder,x=l.showRightBorder,b=m/2,R=u.length-1+(g?1:0)+(y?1:0),v=s.length-1+(w?1:0)+(x?1:0),C=u.map((e=>e.height)),A=s.map((e=>e.width)),k=A.reduce(((e,t)=>e+t),0)+v*m,E=C.reduce(((e,t)=>e+t),0)+R*m,I="center"===o?h.left:0,T="middle"===t?h.top:0,B="center"===o?h.width:l.width,D="middle"===t?h.height:i.height,L=A.reduce(((e,t,o)=>{const n=e[o]+t+m;return e.push(n),e}),[w?m:0]),M=C.reduce(((e,t,o)=>{const n=e[o]+t+m;return e.push(n),e}),[g?m:0]),F=L.slice(0,-1),S=M.slice(0,-1),z=Math.max(F.findLastIndex((e=>e<=I)),0),N=F.findLastIndex((e=>e<=I+B)),O=Math.max(S.findLastIndex((e=>e<=T)),0),H=S.findLastIndex((e=>e<=T+D)),K=Math.max(z,w?0:1),W=N+(x?1:0),P=Math.max(O,g?0:1),$=H+(y?1:0),q=Array.from({length:H-O+1},((e,t)=>{const o=u[t+O];return Array.from({length:N-z+1},((e,t)=>{const n=s[t+z];return p.resolve(o,n)}))})),V=(e,t)=>q[e-O][t-z];r.width=Math.round(B*c),r.height=Math.round(D*c),r.style.width=`${B}px`,r.style.height=`${D}px`,r.style.marginLeft=`${I}px`,r.style.marginTop=`${T}px`,r.style.marginRight=k-B-I+"px",r.style.marginBottom=E-D-T+"px",a.fillStyle="#E9E9E9",a.fillRect(0,0,r.width,r.height);const Y=(e,t)=>{a.setTransform(c,0,0,c,(e-I)*c,(t-T)*c)},G=(e,t,o,n)=>{a.beginPath(),a.rect(e,t,o,n),a.clip()};for(let e=z;e<=N;e++)for(let t=O;t<=H;t++){const o=V(t,e),n=o.style,r=M[t],i=L[e],l=A[e],s=C[t],u=o.text,h=n.textBaseline||"middle",p=o.padding;if(Y(i,r),a.fillStyle=n.background||"white",a.fillRect(0,0,l,s),"draw"in o&&o.draw(a),n.highlight&&(a.fillStyle=n.highlight,a.fillRect(0,0,l,s)),n.corner&&(a.fillStyle=n.corner,a.beginPath(),a.moveTo(l-7,s),a.lineTo(l,s),a.lineTo(l,s-7),a.fill()),u){a.fillStyle=n.foreground||"black",a.font=o.font;const e=f.getFontMetrics(o.font),t="center"==n.textAlign&&f.measureWidth(u,o.font)>l-p.left-p.right?"left":n.textAlign||"left";a.textAlign=t;const r=d("left"===t?p.left:"center"===t?l/2:"right"===t?l-p.right:0,c),i=d("top"===h?e.middle+e.topOffset+p.top:"middle"===h?s/2+e.middle:"bottom"===h?s+e.middle-e.bottomOffset-p.bottom:0,c);a.save(),G(0,2*m,l,s-4*m),a.fillText(u,r,i),a.restore()}}Y(0,0);const j=(e,t,o,n,r)=>{if(!r)return;if(0===r.width)return;const i=r.width/c,l=t===n,s=e-(l?i/2:0),u=t-(l?0:i/2),d=o+(l?i/2:0),h=n+(l?0:i/2);a.strokeStyle=r.color||"black",a.lineWidth=i,r.dash?(a.setLineDash(r.dash.map((e=>e/c))),a.lineDashOffset=l?s:u):a.setLineDash([]),a.beginPath(),a.moveTo(s,u),a.lineTo(d,h),a.stroke()},U=(e,t)=>e?t?e.index>t.index?e:t:e:t;for(let e=P;e<=$;e++){const t=e-1,o=e;for(let e=z;e<=N;e++){const n=U(t>=O?V(t,e).style.borderBottom:null,o<=H?V(o,e).style.borderTop:null);j(L[e]-b,M[o]-b,L[e+1]-b,M[o]-b,n)}}for(let e=K;e<=W;e++){const t=e-1,o=e;for(let e=O;e<=H;e++){const n=U(t>=z?V(e,t).style.borderRight:null,o<=N?V(e,o).style.borderLeft:null);j(L[o]-b,M[e]-b,L[o]-b,M[e+1]-b,n)}}}function a(e){if(!e.error)try{!function(e){c(e,"top","left"),c(e,"top","center"),c(e,"top","right"),c(e,"middle","left"),c(e,"middle","center"),c(e,"middle","right"),c(e,"bottom","left"),c(e,"bottom","center"),c(e,"bottom","right"),function(e){const t=e.element,o=e.input,n=e.state,r=n.inputPlacement;if(!r){if(o.parentElement){const e=document.activeElement===o;o.parentElement.removeChild(o),e&&t.focus({preventScroll:!0})}return}const i=e.canvases[r.section];if(o.style.left="left"in r?`${r.left}px`:"0",o.style.top="top"in r?`${r.top}px`:"0",o.style.right="right"in r?`${r.right}px`:"0",o.style.bottom="bottom"in r?`${r.bottom}px`:"0",o.style.marginLeft="marginLeft"in r?`${r.marginLeft}px`:"0",o.style.marginTop="marginTop"in r?`${r.marginTop}px`:"0",o.style.width=`${r.width}px`,o.style.height=`${r.height}px`,o.style.gridArea=i.style.gridArea,o.style.zIndex=i.style.zIndex,o.style.backgroundColor=n.isTextValid?"white":"#eb3434",!o.parentElement){const e=document.activeElement===t;t.appendChild(o),e&&o.focus({preventScroll:!0})}}(e),function(e){const t=e.element,o=e.state;e.isReordering?t.style.cursor="move":o.resizableColumn&&o.resizableRow?t.style.cursor="nwse-resize":o.resizableColumn?t.style.cursor="col-resize":o.resizableRow?t.style.cursor="row-resize":t.style.cursor="default"}(e),function(e){const t=e.element,o=e.tooltip,n=e.state.tooltip,r=e.state.tooltipPlacement;r?(o.innerHTML!==n&&(o.innerHTML=n),o.style.left=`calc(anchor(left) + ${r.left}px)`,o.style.top=`calc(anchor(top) + ${r.top}px)`,o.parentElement||(t.appendChild(o),o.showPopover({source:t}))):o.parentElement&&o.parentElement.removeChild(o)}(e)}(e)}catch(t){e.error=t}e.error&&function(e){if(e.errorRendered)return;e.errorRendered=!0;const t=e.element,o=e.error;t.style.backgroundColor="#9f0000",t.style.color="white",t.style.padding="20px",t.style.display="flex",t.style.flexDirection="column",t.style.userSelect="text",t.innerHTML=`\n        <div style="font-size: 16px;">\n            An error occurred while rendering the grid, please contact the support.\n        </div>\n        <div style="font-size: 20px; font-weight: bold; padding: 20px 0;">\n            ${o.message}\n        </div>\n        <div style="font-size: 16px; white-space: pre-wrap;">${o.stack}</div>\n    `}(e)}const h={value:({newValue:e})=>e||"",text:({newValue:e})=>e||"Search...",edit:{validate:()=>!0,parse:({string:e})=>e,autoCommit:!0}};function f(e,t,o){return[{column:{type:"DATA"},row:{type:"HEADER"},value:({column:e})=>void 0===e.header?e.id:e.header},{column:{type:"HEADER"},row:{type:"DATA"},value:({row:e})=>void 0===e.header?e.id:e.header},{column:{type:"HEADER"},row:{type:"SPECIAL"},value:""},{column:{type:"SPECIAL"},row:{type:"HEADER"},value:""},{column:{type:"DATA"},row:{type:"FILTER"},...h},{column:{type:"FILTER"},row:{type:"DATA"},...h},{column:{type:"DATA"},row:{type:"DATA"},value:t},...e,...o.map((({columnId:e,rowId:t,direction:n},r)=>({column:{id:e},row:{id:t},text:({value:e,text:t})=>`${o.length>1?r+1:""}${"ASC"===n?"⇣":"⇡"} ${t||e}`})))]}const p=["column","row","condition"];function m(e){return Object.keys(e).length>Object.keys(e).filter((e=>p.includes(e))).length}function g(e,t){const o=[...p,...t];return e.map((e=>function(e,t){const o={};for(const n of t)n in e&&(o[n]=e[n]);return o}(e,o))).filter(m)}function y(e){return g(e,["value","text","edit"])}function w(e,t){return t?e+"99":e+"33"}function x(e,t,o,n,r,i,s,u,d,c,a,h,f){const p=o?l(o.columnId):null,m=o?l(o.rowId):null,g=null!==d,y=null!==u||g,x=c+2,b=c+4,R=(e,t,o,r)=>{if(o<0||o>=e.length)return!1;if(r<0||r>=t.length)return!1;const i=e[o].key,l=t[r].key;return n.isKeySelected(i,l)},v=(e,t)=>e?[t]:[];return[{column:{type:"DATA"},row:{type:"FILTER"},style:({newValue:e})=>({background:"#FBFBFB",foreground:e?"black":"#cccccc",border:{width:1,color:"gray"}})},{column:{type:"FILTER"},row:{type:"DATA"},style:({newValue:e})=>({background:"#FBFBFB",foreground:e?"black":"#cccccc",border:{width:1,color:"gray"}})},{column:{type:"ANY"},row:{type:"HEADER"},style:{background:"#F5F5F5",border:{width:c,color:"gray"}}},{column:{type:"HEADER"},row:{type:"ANY"},style:{background:"#F5F5F5",border:{width:c,color:"gray"}}},{column:{type:"HEADER"},row:{type:"HEADER"},style:{background:"#E0E0E0"}},...e,...v(t&&!g,{column:{type:"ANY"},row:{id:t?.rowId},style:{highlight:"#81948133"}}),...v(t&&!y,{column:{id:t?.columnId},row:{id:t?.rowId},style:{highlight:"#81948188"}}),{column:{type:"ANY"},row:{type:"ANY"},condition:({rows:e,columns:t,row:o,column:n})=>R(e,t,o.index,n.index),style:({rows:e,columns:t,row:o,column:n,edit:r})=>({...R(e,t,o.index-1,n.index)?{}:{borderTop:{width:x,color:"#596959",index:Number.MAX_SAFE_INTEGER}},...R(e,t,o.index+1,n.index)?{}:{borderBottom:{width:x,color:"#596959",index:Number.MAX_SAFE_INTEGER}},...R(e,t,o.index,n.index-1)?{}:{borderLeft:{width:x,color:"#596959",index:Number.MAX_SAFE_INTEGER}},...R(e,t,o.index,n.index+1)?{}:{borderRight:{width:x,color:"#596959",index:Number.MAX_SAFE_INTEGER}},highlight:w(r?"#798d9c":"#819481",p!==n.key||m!==o.key)})},{column:{type:"ANY"},row:{type:"ANY"},condition:({row:e,column:t})=>r.isKeySelected(e.key,t.key),style:({row:e,column:t})=>({highlight:w("#93a8b8",p!==t.key||m!==e.key)})},...v(!!o,{column:{id:o?.columnId},row:{id:o?.rowId},style:{highlight:"#ffffffaa"}}),...s.map((({columnId:e,rowId:t,direction:o},n)=>({column:{id:e},row:{id:t},style:{highlight:"#0377fc44"}}))),{column:{type:"ANY"},row:{type:"ANY"},condition:({edit:e})=>!!e,style:{corner:"#77777720"}},{column:{type:"ANY"},row:{type:"ANY"},condition:({row:e,column:t})=>i.hasValueByKey(e.key,t.key),style:{corner:"darkgreen"}},...v(u,{column:{id:u},row:{type:"HEADER"},style:{borderRight:{width:b,color:"cornflowerblue"}}}),...v(d,{column:{type:"HEADER"},row:{id:d},style:{borderBottom:{width:b,color:"cornflowerblue"}}}),...v(a&&h,{column:{id:h},row:{type:"ANY"},style:{highlight:"#3a74e055"}}),...v(a&&f,{column:{type:"ANY"},row:{id:f},style:{highlight:"#3a74e055"}})]}function b(e,t){const o=t.filter((e=>"BEGIN"===e.pinned)).length,n=t.filter((e=>"END"===e.pinned)).length,r=t.length-o-n,i=e.filter((e=>"BEGIN"===e.pinned)).length,l=e.filter((e=>"END"===e.pinned)).length,s=e.length-i-l,u=t.slice(0,o),d=t.slice(t.length-n,t.length),c=t.slice(o,t.length-n),a=e.slice(0,i),h=e.slice(e.length-l,e.length),f=e.slice(i,e.length-l),p=o>0,m=i>0,g=!0,y=!0,w=r>0||!p,x=!0,b=!p,R=!(n>0),v=!0,C=!0,A=s>0||!m,k=!0,E=!m,I=!(l>0),T=(e,t,o)=>{if(0===e.length)return 0;const n=t?e.at(0).topWithBorder:e.at(0).top;return(o?e.at(-1).bottomWithBorder:e.at(-1).bottom)-n},B=(e,t,o)=>{if(0===e.length)return 0;const n=t?e.at(0).leftWithBorder:e.at(0).left;return(o?e.at(-1).rightWithBorder:e.at(-1).right)-n};return{top:{rows:u,showTopBorder:g,showBottomBorder:y,height:T(u,g,y)},bottom:{rows:d,showTopBorder:w,showBottomBorder:x,height:T(d,w,x)},middle:{rows:c,showTopBorder:b,showBottomBorder:R,height:T(c,b,R)},left:{columns:a,showLeftBorder:v,showRightBorder:C,width:B(a,v,C)},right:{columns:h,showLeftBorder:A,showRightBorder:k,width:B(h,A,k)},center:{columns:f,showLeftBorder:E,showRightBorder:I,width:B(f,E,I)}}}function R(e,t){return[...e,...t.map((e=>({columnId:e.columnId,rowId:e.rowId,value:e.expression})))]}class v{constructor(e){this.lookup=new Map,e.forEach((e=>{const t=l(e.rowId),o=l(e.columnId);this.lookup.has(t)||this.lookup.set(t,new Map),this.lookup.get(t).set(o,e.value)}))}hasValueByKey(e,t){return this.lookup.has(e)&&this.lookup.get(e).has(t)}getValueByKey(e,t){if(this.hasValueByKey(e,t))return this.lookup.get(e).get(t)}hasValueById(e,t){return this.hasValueByKey(l(e),l(t))}getValueById(e,t){return this.getValueByKey(l(e),l(t))}}function C(e){return new v(e)}class A{constructor(e){this.lookup=new Map,e.forEach((e=>{const t=l(e.rowId),o=l(e.columnId);this.lookup.has(t)||this.lookup.set(t,new Set),this.lookup.get(t).add(o)}))}isKeySelected(e,t){return this.lookup.has(e)&&this.lookup.get(e).has(t)}isIdSelected(e,t){return this.isKeySelected(l(e),l(t))}}function k(e){return new A(e)}function E(e,t){return"function"==typeof e?e(t):e}function I(e,t){return"function"==typeof e?e(t):e}function T(e,t,o,n){return e<o?"BEGIN":e>=t-n?"END":void 0}function B(e,t,o){return e.map(((n,r)=>{const i="id"in n?n.id:n.type;return{...n,id:i,type:n.type||"DATA",key:l(i),pinned:T(r,e.length,t,o),header:"header"in n?n.header:i,labels:n.labels||[],index:r}}))}function D(e,t,o,n){const r=new Map(n.map((({columnId:e,width:t})=>[l(e),t])));return B(e,t,o).map((e=>({...e,width:r.has(e.key)?r.get(e.key):"width"in e?e.width:"fit"})))}function L(e,t,o,n){const r=new Map(n.map((({rowId:e,height:t})=>[l(e),t])));return B(e,t,o).map((e=>({...e,height:r.has(e.key)?r.get(e.key):"height"in e?e.height:"fit"})))}function M(e,t,o){let n=o;return e.map(((e,r)=>{const i=d("width"in e?e.width:100,t),l={...e,index:r,width:i,leftWithBorder:n-o,left:n,right:n+i,rightWithBorder:n+i+o};return n+=l.width+o,l}))}function F(e,t,o){let n=o;return e.map(((e,r)=>{const i=d("height"in e?e.height:20,t),l={...e,index:r,height:i,topWithBorder:n-o,top:n,bottom:n+i,bottomWithBorder:n+i+o};return n+=l.height+o,l}))}const S="12px Calibri",z={top:2,right:5,bottom:2,left:5};function N(e){return"function"==typeof e?e:()=>e}const O={HEADER:["HEADER"],FILTER:["FILTER"],DATA:["DATA"],CUSTOM:["CUSTOM"],ANY:["HEADER","DATA","FILTER","CUSTOM"],SPECIAL:["HEADER","FILTER","CUSTOM"],NONE:[]};class H{byKey=new Map;byIndex=new Map;byLabel=new Map;byType=new Map}class K{lookup=new H;hasRules=!1;addRule(e,t,o){if(this.hasRules=!0,Array.isArray(e)){for(const n of e)this.addRule(n,t,o);return}if(Array.isArray(t)){for(const n of t)this.addRule(e,n,o);return}const n=e?"id"in e?{key:l(e.id)}:e:{type:"DATA"},r=t?"id"in t?{key:l(t.id)}:t:{type:"DATA"};function i(e,t){e.has(t)||e.set(t,[]),e.get(t).push(o)}function s(e,t){if(e.has(t)||e.set(t,new H),"key"in r)i(e.get(t).byKey,r.key);else if("index"in r)i(e.get(t).byIndex,r.index);else if("label"in r)i(e.get(t).byLabel,r.label);else for(const o of O[r.type||"NONE"])i(e.get(t).byType,o)}if("key"in n)s(this.lookup.byKey,n.key);else if("index"in n)s(this.lookup.byIndex,n.index);else if("label"in n)s(this.lookup.byLabel,n.label);else for(const e of O[n.type||"NONE"])s(this.lookup.byType,e)}getRules(e,t){const o=[];if(!this.hasRules)return o;function n(e){for(const t of e)o.push(t)}function r(e){e.byKey.has(t.key)&&n(e.byKey.get(t.key)),e.byIndex.has(t.index)&&n(e.byIndex.get(t.index)),e.byType.has(t.type)&&n(e.byType.get(t.type));for(const o of t.labels)e.byLabel.has(o)&&n(e.byLabel.get(o))}this.lookup.byKey.has(e.key)&&r(this.lookup.byKey.get(e.key)),this.lookup.byIndex.has(e.index)&&r(this.lookup.byIndex.get(e.index)),this.lookup.byType.has(e.type)&&r(this.lookup.byType.get(e.type));for(const t of e.labels)this.lookup.byLabel.has(t)&&r(this.lookup.byLabel.get(t));return o}}const W=["borderTop","borderRight","borderBottom","borderLeft"],P={validate:()=>!0,parse:({string:e})=>e};function $(e,t){const o={...e};if("border"in o){for(const e of W)o[e]=o.border;delete o.border}for(const e of W)e in o&&(o[e]={...o[e],index:t});return o}function q(e,t){if(!1!==e.edit)return!0===e.edit?"edit"in t?t.edit:P:"edit"in t?{...t.edit,...e.edit}:{...P,...e.edit}}class V{constructor(e){this.rulesLookup=new K;for(const[t,o]of e.entries()){const e={index:t};"condition"in o&&(e.condition=o.condition),"style"in o&&(e.style=N(o.style)),"value"in o&&(e.value=N(o.value)),"text"in o&&(e.text=N(o.text)),"font"in o&&(e.font=N(o.font)),"padding"in o&&(e.padding=N(o.padding)),"edit"in o&&(e.edit=o.edit),"tooltip"in o&&(e.tooltip=N(o.tooltip)),"draw"in o&&(e.draw=o.draw),this.rulesLookup.addRule(o.column,o.row,e)}}resolve(e,t,o,n,r,i){const l=this.rulesLookup.getRules(r,n).sort(((e,t)=>e.index-t.index)).filter(((e,t,o)=>e.index!==o[t-1]?.index));let s,u,d={data:e,rows:t,columns:o,row:n,column:r},c={},a=z,h=S;i.hasValueByKey(n.key,r.key)&&(d={...d,newValue:i.getValueByKey(n.key,r.key)});for(const e of l)if((!("condition"in e)||e.condition(d))&&("value"in e&&(d={...d,value:e.value(d)}),"style"in e&&(c={...c,...$(e.style(d),e.index)}),"text"in e&&(d={...d,text:e.text(d)}),"font"in e&&(h=e.font(d)),"padding"in e&&(a={...a,...e.padding(d)}),"edit"in e&&(d={...d,edit:q(e,d)}),"tooltip"in e&&(u=e.tooltip(d)),"draw"in e)){const t=d;s=o=>e.draw({...t,ctx:o})}const f=function(e){return"text"in e?`${e.text}`:"newValue"in e?`${e.newValue}`:void 0!==e.value?`${e.value}`:""}(d),p={style:c,text:f,padding:a,font:h};return"value"in d&&(p.value=d.value),"edit"in d&&void 0!==d.edit&&(p.edit=d.edit),void 0!==u&&(p.tooltip=u),void 0!==s&&(p.draw=s),p}}function Y(e){return new V(e)}class G{constructor(e,t,o,n,r){this.formattingRules=e,this.data=t,this.rows=o,this.columns=n,this.edition=r}resolve(e,t){return this.formattingRules.resolve(this.data,this.rows,this.columns,e,t,this.edition)}}function j(e,t,o,n,r){return new G(e,t,o,n,r)}function U(e,t,o){const n=new Map;for(const r of e){const e=l(r[t]),i=l(r[o]);n.has(e)||n.set(e,new Map),n.get(e).set(i,r.expression)}return n}function _(e,t,o,n,r,i,l){if(0===e.length)return r;const s=U(e,"columnId","rowId"),u=i.filter((e=>"FILTER"!==e.type&&s.has(e.key)));return 0===u.length?r:r.filter((e=>{for(const d of u){const u=o.resolve(n,r,i,e,d,l),c=s.get(d.key);if(!t.resolve(n,r,i,e,d,u.value,u.text,c))return!1}return!0}))}function X(e,t,o,n,r,i,l){if(0===e.length)return i;const s=U(e,"rowId","columnId"),u=r.filter((e=>"FILTER"!==e.type&&s.has(e.key)));return 0===u.length?i:i.filter((e=>{for(const d of u){const u=o.resolve(n,r,i,d,e,l),c=s.get(d.key);if(!t.resolve(n,r,i,d,e,u.value,u.text,c))return!1}return!0}))}function J(e,t,o,n){return{top:e,bottom:t,left:o,right:n}}function Q(e,t){return{width:e.length?e.at(-1).rightWithBorder:0,height:t.length?t.at(-1).bottomWithBorder:0}}class Z{constructor(){this.fontMetrics=new Map,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}measureWidth(e,t){if(!e)return 0;const o=this.context;return o.font=t||S,o.measureText(e).width}measureHeight(e,t){let o=1;for(const t of e)"\n"===t&&o++;return o*this.getFontMetrics(t).height}getFontMetrics(e){const t=e;if(this.fontMetrics.has(t))return this.fontMetrics.get(t);const o=this.context;o.font=e||S;const n=o.measureText("X"),r=(n.actualBoundingBoxDescent-n.actualBoundingBoxAscent)/2,i={topOffset:r+n.fontBoundingBoxAscent,middle:-r,bottomOffset:n.fontBoundingBoxDescent-r,height:n.fontBoundingBoxAscent+n.fontBoundingBoxDescent};return this.fontMetrics.set(t,i),i}}function ee(){return new Z}function te(e,t){return t.top>=e.top&&t.left>=e.left&&t.top+t.height<=e.top+e.height&&t.left+t.width<=e.left+e.width}function oe(e,t){const o={top:Math.max(e.top,t.top),left:Math.max(e.left,t.left),width:Math.min(e.left+e.width,t.left+t.width)-Math.max(e.left,t.left),height:Math.min(e.top+e.height,t.top+t.height)-Math.max(e.top,t.top)};return o.width>=0&&o.height>=0?o:{top:e.top,left:e.left,width:0,height:0}}function ne(e,t){return{top:e.top-t,left:e.left-t,width:e.width+2*t,height:e.height+2*t}}function re(e){return e.width*e.height}function ie(e,t){return{top:e.top,left:e.left,width:Math.max(0,e.width-t.left-t.right),height:Math.max(0,e.height-t.top-t.bottom)}}const le=200,se=400,ue={left:0,top:0,width:0,height:0};function de(e,t,o,n){const r=t.x,i=t.y,l=e.scrollLeft,s=e.scrollTop,u=e.clientWidth,d=e.clientHeight;return{x:r<=o.left?r:r>=u?r+l:r>=u-o.right?n.width-u+r:r+l,y:i<=o.top?i:i>=d?i+s:i>=d-o.bottom?n.height-d+i:i+s}}function ce(e){return e.reduce(((e,t)=>e.set(t.key,t)),new Map)}function ae(e,t,o,n,r,i,s,u){if(!e)return[];if(!t)return[];if(!n)return[];if(!o)return[];const d=l(o.columnId),c=l(o.rowId),a=l(n.columnId),h=l(n.rowId);if(!s.has(d))return[];if(!u.has(c))return[];if(!s.has(a))return[];if(!u.has(h))return[];const f=Math.min(s.get(d).index,s.get(a).index),p=Math.max(s.get(d).index,s.get(a).index),m=Math.min(u.get(c).index,u.get(h).index),g=Math.max(u.get(c).index,u.get(h).index);return r.slice(f,p+1).flatMap((e=>i.slice(m,g+1).map((t=>({rowId:t.id,columnId:e.id})))))}function he(e,t){const o=function(e){return"BEGIN"===e.pinned?"top":"END"===e.pinned?"bottom":"middle"}(t),n=function(e){return"BEGIN"===e.pinned?"left":"END"===e.pinned?"right":"center"}(e);return`${o}-${n}`}function fe(e,t,o,n,r){return 0===e.length?null:function(e,t,o,n){if(!e)return null;const r=l(e.columnId),i=l(e.rowId);if(!t.has(r))return null;if(!o.has(i))return null;const s=t.get(r),u=o.get(i),d={width:s.width,height:u.height,section:he(s,u)};switch(u.pinned){case"BEGIN":d.top=u.top;break;case"END":d.bottom=n.top.height+n.middle.height+n.bottom.height-u.top-u.height;break;default:d.marginTop=u.top-n.top.height}switch(s.pinned){case"BEGIN":d.left=s.left;break;case"END":d.right=n.left.width+n.center.width+n.right.width-s.left-s.width;break;default:d.marginLeft=s.left-n.left.width}return d}(t,o,n,r)}function pe(e,t){return t.every((t=>t.edit.validate({string:e})))}function me(e){return Array.isArray(e)?e.map(((e,t)=>t)):Object.keys(e)}function ge(e){return me(e)}function ye(e){const t=new Set;if(Array.isArray(e))for(const o of e)for(const e of me(o))t.add(e);else for(const o in e)for(const n of me(e[o]))t.add(n);return Array.from(t)}function we(e,t){if(!e.some((e=>"DATA-BLOCK"===e.type)))return e;const o=[];for(const n of e)if("DATA-BLOCK"===n.type){const e="selector"in n?n.selector(t):ye(t);for(const t of e)o.push({...n,id:t,type:"DATA"})}else o.push(n);return o}function xe(e,t){if(!e.some((e=>"DATA-BLOCK"===e.type)))return e;const o=[];for(const n of e)if("DATA-BLOCK"===n.type){const e="selector"in n?n.selector(t):ge(t);for(const t of e)o.push({...n,id:t,type:"DATA"})}else o.push(n);return o}const be=({text:e,expression:t})=>e.includes(t);class Re{constructor(e){this.rulesLookup=new K;for(const t of e){const e={by:l("by"in t?t.by:"FILTER"),condition:t.condition||be};this.rulesLookup.addRule(t.column,t.row,e)}}resolve(e,t,o,n,r,i,l,s){const u=this.rulesLookup.getRules(r,n);if(0===u.length)return"DATA"!==n.type||"DATA"!==r.type||!s.has('"FILTER"')||be({text:l,expression:s.get('"FILTER"')});let d={data:e,rows:t,columns:o,row:n,column:r,value:i,text:l};for(const e of u){if(!s.has(e.by))continue;const t={...d,expression:s.get(e.by)};if(!e.condition(t))return!1}return!0}}function ve(e){return new Re(e)}function Ce(e){return g(e,["value","text"])}function Ae(e){return g(e,["value","text","font","padding"])}function ke(e,t,o,n,r,i){if(e.every((e=>"number"==typeof e.width)))return e;const l=e=>{const i=e.width;if("number"==typeof i)return i;if(r.has(e.key)){const t=r.get(e.key);if("fit-once"===i&&!t.dataOnly)return t.width;if("fit-data-once"===i&&t.dataOnly)return t.width}let l=0;for(const r of t){if("DATA"!==r.type&&"fit-data-once"===i)continue;if("DATA"!==r.type&&"fit-data"===i)continue;const t=n.resolve(r,e),s=t.text,u=t.font,d=t.padding.left+t.padding.right,c=o.measureWidth(s,u)+d;l=Math.max(l,c)}return r.set(e.key,{width:l,dataOnly:"fit-data-once"===i}),l};for(const e of r.keys())i.has(e)||r.delete(e);return e.map((e=>({...e,width:l(e)})))}function Ee(e,t,o,n,r,i){if(t.every((e=>"number"==typeof e.height)))return t;const l=t=>{const i=t.height;if("number"==typeof i)return i;if(r.has(t.key)){const e=r.get(t.key);if("fit-once"===i&&!e.dataOnly)return e.height;if("fit-data-once"===i&&e.dataOnly)return e.height}let l=0;for(const r of e){if("DATA"!==r.type&&"fit-data-once"===i)continue;if("DATA"!==r.type&&"fit-data"===i)continue;const e=n.resolve(t,r),s=e.text,u=e.font,d=e.padding.top+e.padding.bottom,c=o.measureHeight(s,u)+d;l=Math.max(l,c)}return r.set(t.key,{height:l,dataOnly:"fit-data-once"===i}),l};for(const e of r.keys())i.has(e)||r.delete(e);return t.map((e=>({...e,height:l(e)})))}function Ie(e){return new Set(e.map((e=>e.key)))}function Te(e){return g(e,["value","text"])}function Be(e,t){return null!=e.value&&(null==t.value||e.value<t.value)}function De(e,t){return null!=e.value&&(null==t.value||e.value>t.value)}class Le{constructor(e){this.rulesLookup=new K;for(const t of e){const e=t.comparator?(e,o)=>t.comparator(e,o):(e,t)=>Be(e,t),o=t.comparator?(e,o)=>!t.comparator(e,o):(e,t)=>De(e,t),n={by:l("by"in t?t.by:"HEADER"),comparatorAsc:e,comparatorDesc:o};this.rulesLookup.addRule(t.column,t.row,n)}}resolve(e,t,o){const n=this.rulesLookup.getRules(e,t);if(0===n.length)return"DATA"!==t.type||"DATA"!==e.type?null:o.has('"HEADER"')?"ASC"===o.get('"HEADER"')?Be:De:null;if(n.length>1)throw new Error("Multiple sorting rules for the same cell");const r=n[0];return o.has(r.by)?"ASC"===o.get(r.by)?r.comparatorAsc:r.comparatorDesc:null}}function Me(e){return"manual"===e?null:new Le(e)}function Fe(e,t,o){const n=new Map;for(const r of e){const e=l(r[t]),i=l(r[o]);n.has(e)||n.set(e,new Map),n.get(e).set(i,r.direction)}return n}function Se(e,t){e.sort(((e,t)=>{const o=e.comparator(e.cell,t.cell);return"number"==typeof o?o:o?-1:1})),t.push(...e.map((e=>e.entity))),e.length=0}function ze(e,t,o,n,r,i,s){if(0===e.length)return r;if(null===t)return r;const u=Fe(e,"columnId","rowId"),d=new Map(i.map((e=>[e.key,e]))),c=e.map((e=>l(e.columnId))).filter((e=>d.has(e))).map((e=>d.get(e))).reverse();if(0===c.length)return r;for(const e of c){const l=[],d=[];for(const c of r){const a=t.resolve(e,c,u.get(e.key));if(!a){Se(d,l),l.push(c);continue}const h={entity:c,comparator:a,cell:o.resolve(n,r,i,c,e,s)};0!==d.length&&d[0].comparator!==a?(Se(d,l),d.push(h)):d.push(h)}Se(d,l),r=l}return r}function Ne(e,t,o,n,r,i,s){if(0===e.length)return i;if(null===t)return i;const u=Fe(e,"rowId","columnId"),d=new Map(r.map((e=>[e.key,e]))),c=e.map((e=>l(e.rowId))).filter((e=>d.has(e))).map((e=>d.get(e))).reverse();if(0===c.length)return i;for(const e of c){const l=[],d=[];for(const c of i){const a=t.resolve(c,e,u.get(e.key));if(!a){Se(d,l),l.push(c);continue}const h={entity:c,comparator:a,cell:o.resolve(n,r,i,e,c,s)};0!==d.length&&d[0].comparator!==a?(Se(d,l),d.push(h)):d.push(h)}Se(d,l),i=l}return i}const Oe=5;function He(e,t,o,n,r,i,s,u,d){if(!n)return null;if(s)return null;const c=t.get(l(n.columnId));if("HEADER"!==o.get(l(n.rowId)).type)return null;const a=de(r,i,u,d);if(!a)return null;const h=a.x;return h>=c.right-Oe&&h<=c.right+Oe?c.id:0===c.index||h<c.left-Oe||h>c.left+Oe?null:e[c.index-1].id}function Ke(e,t,o,n,r,i,s,u,d){if(!n)return null;if(s)return null;const c=t.get(l(n.columnId)),a=o.get(l(n.rowId));if("HEADER"!==c.type)return null;const h=de(r,i,u,d);if(!h)return null;const f=h.y;return f>=a.bottom-Oe&&f<=a.bottom+Oe?a.id:0===a.index||f<a.top-Oe||f>a.top+Oe?null:e[a.index-1].id}function We(e){return e.map((e=>({columnId:"columnId"in e?e.columnId:"HEADER",rowId:"rowId"in e?e.rowId:"HEADER",direction:e.direction})))}function Pe(e){return e.map((e=>({columnId:"columnId"in e?e.columnId:"FILTER",rowId:"rowId"in e?e.rowId:"FILTER",expression:e.expression})))}function $e(e){return e.filter((e=>"DATA"===e.type)).map((e=>e.id))}function qe(e){return $e(e)}function Ve(e){return $e(e)}function Ye(e){return g(e,["value","text","tooltip"])}function Ge(e,t,o,n){if(!e)return null;const r=l(e.columnId),i=l(e.rowId);if(!o.has(r))return null;if(!n.has(i))return null;const s=n.get(i),u=o.get(r);return t.resolve(s,u).tooltip}function je(e,t){return e?{left:t.x+8,top:t.y+20}:null}function Ue(e){return e.map((e=>l(e)))}function _e(e,t){if(!t)return e;const o=new Map;for(const t of e)o.set(t.key,t);const n=[];for(const e of t)o.has(e)&&(n.push(o.get(e)),o.delete(e));for(const t of e)o.has(t.key)&&n.push(o.get(t.key));return[...n.filter((e=>"BEGIN"===e.pinned)),...n.filter((e=>!e.pinned)),...n.filter((e=>"END"===e.pinned))]}function Xe(e){const t={...e.localOptions,...e.externalOptions},o=e.memory,n=e.state,r=e.element,i=[];function l(e,t,n){const r=o[e]&&o[e].dependencies;return r&&!n.some(((e,t)=>e!==r[t]))||(o[e]={value:t(...n),dependencies:n},i.push(e)),o[e].value}function s(e,t){const n=o[e]&&o[e].value;return JSON.stringify(n)!==JSON.stringify(t)&&(o[e]={value:t},i.push(e)),o[e].value}function d(e,t,n){(o[e]&&o[e].value)!==t&&(o[e]={value:t},n(t))}const c=window.devicePixelRatio,a=t.borderWidth/c,h=t.data,p=e.input.value,m=l("sortBy",We,[t.sortBy]),g=l("filters",Pe,[t.filters]),w=l("textResolver",ee,[]),v=l("dataFormatting",f,[t.formatting,t.dataSelector,m]),A=l("editedCellsAndFilters",R,[t.editedCells,g]),T=l("edition",C,[A]),B=l("invokedColumns",E,[t.columns,h]),S=l("invokedRows",I,[t.rows,h]),z=l("unfoldedColumns",we,[B,h]),N=l("unfoldedRows",xe,[S,h]),O=l("unfilteredColumns",D,[z,t.pinnedLeft,t.pinnedRight,t.columnWidths]),H=l("unfilteredRows",L,[N,t.pinnedTop,t.pinnedBottom,t.rowHeights]),K=l("unfilteredColumnKeys",Ie,[O]),W=l("unfilteredRowKeys",Ie,[H]),P=l("columnsOrder",Ue,[t.columnsOrder]),$=l("rowsOrder",Ue,[t.rowsOrder]),q=l("orderedColumns",_e,[O,P]),V=l("orderedRows",_e,[H,$]),G=l("filterFormatting",Ce,[v]),U=l("filterFormattingRules",Y,[G]),Z=l("filteringRules",ve,[t.filtering]),he=l("filteredColumns",X,[g,Z,U,h,V,q,T]),me=l("filteredRows",_,[g,Z,U,h,V,q,T]),ge=l("sortingFormatting",Te,[v]),ye=l("sortingFormattingRules",Y,[ge]),be=l("sortingRules",Me,[t.sorting]),Re=l("sortedColumns",Ne,[m,be,ye,h,me,he,T]),Be=l("sortedRows",ze,[m,be,ye,h,me,he,T]),De=l("measureFormatting",Ae,[v]),Le=l("measureFormattingRules",Y,[De]),Fe=l("measureFormatResolver",j,[Le,h,Be,Re,T]),Se=e.columnWidthCache,Oe=e.rowHeightCache,$e=l("measuredColumns",ke,[Re,Be,w,Fe,Se,K]),Xe=l("measuredRows",Ee,[Re,Be,w,Fe,Oe,W]),Je=l("columns",M,[$e,c,a]),Qe=l("rows",F,[Xe,c,a]),Ze=l("columnLookup",ce,[Je]),et=l("rowLookup",ce,[Qe]),tt=t.focusedCell,ot=l("sections",b,[Je,Qe]),nt=t.selectedCells,rt=l("fixedSize",J,[ot.top.height,ot.bottom.height,ot.left.width,ot.right.width]),it=l("totalSize",Q,[Je,Qe]),lt=s("hoveredCell",function(e,t,o,n,r,i){if(!t)return null;if(t.x<0||t.y<0||t.x>i.width||t.y>i.height)return null;const l=de(e,t,r,i),s=function(e,t){if(0===e.length)return-1;if(t<e[0].topWithBorder)return-1;if(t>e[e.length-1].bottomWithBorder)return-1;let o=0,n=e.length-1;for(;o<=n;){const r=Math.floor((o+n)/2);if(t<e[r].topWithBorder)n=r-1;else{if(!(t>e[r].bottomWithBorder))return r;o=r+1}}return-1}(o,l.y),u=function(e,t){if(0===e.length)return-1;if(t<e[0].leftWithBorder)return-1;if(t>e[e.length-1].rightWithBorder)return-1;let o=0,n=e.length-1;for(;o<=n;){const r=Math.floor((o+n)/2);if(t<e[r].leftWithBorder)n=r-1;else{if(!(t>e[r].rightWithBorder))return r;o=r+1}}return-1}(n,l.x);return-1===s||-1===u?null:{rowId:o[s].id,columnId:n[u].id}}(r,e.mousePosition,Qe,Je,rt,it)),st=e.isReordering,ut=e.resizingColumn||l("resizableColumn",He,[Je,Ze,et,lt,r,e.mousePosition,st,rt,it]),dt=e.resizingRow||l("resizableRow",Ke,[Qe,Ze,et,lt,r,e.mousePosition,st,rt,it]),ct=l("highlightedCells",ae,[e.isMouseDown,!ut&&!dt&&!e.didReorder,tt,lt,Je,Qe,Ze,et]),at=l("selection",k,[nt]),ht=l("highlight",k,[ct]),ft=l("renderFormatting",x,[v,lt,tt,at,ht,T,m,ut,dt,t.borderWidth,st,e.reorderedColumn,e.reorderedRow]),pt=l("renderFormattingRules",Y,[ft]),mt=l("renderFormatResolver",j,[pt,h,Qe,Je,T]),gt=l("inputFormatting",y,[v]),yt=l("inputFormattingRules",Y,[gt]),wt=l("inputFormatResolver",j,[yt,h,Qe,Je,T]),xt=l("editableCells",u,[nt,wt,Ze,et]),bt=l("inputPlacement",fe,[xt,tt,Ze,et,ot]),Rt=l("isTextValid",pe,[p,xt]),vt=l("contextFormatting",Ye,[v]),Ct=l("contextFormattingRules",Y,[vt]),At=l("contextFormatResolver",j,[Ct,h,Qe,Je,T]),kt=l("tooltip",Ge,[lt,At,Ze,et]),Et=l("tooltipPlacement",je,[kt,e.mousePosition]),It=s("scrollRect",function(e,t,o,n){const r={width:n.getBoundingClientRect().width,height:n.getBoundingClientRect().height},i={left:n.scrollLeft,top:n.scrollTop},l=e||ue,s=ie({left:0,top:0,...t},o),u=ie({...i,...r},o),d=oe(s,ne(u,le)),c=oe(s,ne(u,se));return te(s,l)&&te(l,d)?re(l)>2*re(c)?c:l:c}(n?.scrollRect,it,rt,r)),Tt=l("activeColumns",qe,[Je]),Bt=l("activeRows",Ve,[Qe]);d("activeColumnsCallback",Tt,t.onActiveColumnsChange),d("activeRowsCallback",Bt,t.onActiveRowsChange),d("hoveredCellCallback",lt,t.onHoveredCellChange),t.onStateChange(i),e.state={options:t,devicePixelRatio:c,borderWidth:a,edition:T,columns:Je,rows:Qe,sections:ot,hoveredCell:lt,focusedCell:tt,renderFormatResolver:mt,inputFormatResolver:wt,fixedSize:rt,totalSize:it,textResolver:w,scrollRect:It,highlightedCells:ct,inputPlacement:bt,columnLookup:Ze,rowLookup:et,text:p,isTextValid:Rt,resizableColumn:ut,resizableRow:dt,tooltip:kt,tooltipPlacement:Et}}function Je(e){if(!e.error)try{Xe(e)}catch(t){e.error=t}}function Qe(e,t){const o=new A(t);return[...t,...e.filter((e=>!o.isIdSelected(e.rowId,e.columnId)))]}function Ze(e,t){const o=new A(t);return e.filter((e=>!o.isIdSelected(e.rowId,e.columnId)))}function et(e){const t=e.currentTarget;if(!(t instanceof HTMLElement))throw new Error("Element is not an HTMLElement");const o=t.getBoundingClientRect();return{x:e.clientX-o.left,y:e.clientY-o.top}}function tt(e,t){return e.map((e=>({...e,columnId:"columnId"in e?e.columnId:t,rowId:"rowId"in e?e.rowId:t})))}function ot(e,t,o){const n=l(t),r=l(o);if(n===r)return null;const i=e.findIndex((e=>e.key===n)),s=e.findIndex((e=>e.key===r));return-1===i||-1===s||i===s?null:[i,s]}class nt{constructor(e,t,o,n){this.element=e,this.canvases=t,this.input=o,this.tooltip=n,this.localOptions={data:[],columns:[{type:"DATA-BLOCK"}],rows:[{type:"HEADER"},{type:"DATA-BLOCK"}],formatting:[],filtering:[],sorting:[],dataSelector:({data:e,row:t,column:o})=>e?.[t.id]?.[o.id],pinnedTop:0,pinnedBottom:0,pinnedLeft:0,pinnedRight:0,borderWidth:1,focusedCell:null,onFocusedCellChange:e=>{this.localOptions.focusedCell=e,this.requestNewRender()},selectedCells:[],onSelectedCellsChange:e=>{this.localOptions.selectedCells=e,this.requestNewRender()},highlightedCells:[],editedCells:[],onEditedCellsChange:e=>{this.localOptions.editedCells=e,this.requestNewRender()},filters:[],onFiltersChange:e=>{this.localOptions.filters=e,this.requestNewRender()},sortBy:[],onSortByChange:e=>{this.localOptions.sortBy=e,this.requestNewRender()},onCellClick:()=>{},onCustomCellClick:()=>{},columnWidths:[],onColumnWidthsChange:e=>{this.localOptions.columnWidths=e,this.requestNewRender()},rowHeights:[],onRowHeightsChange:e=>{this.localOptions.rowHeights=e,this.requestNewRender()},columnsOrder:[],onColumnsOrderChange:e=>{this.localOptions.columnsOrder=e,this.requestNewRender()},rowsOrder:[],onRowsOrderChange:e=>{this.localOptions.rowsOrder=e,this.requestNewRender()},onActiveColumnsChange:()=>{},onActiveRowsChange:()=>{},onHoveredCellChange:()=>{},onStateChange:()=>{}}}externalOptions={};state=null;memory={};renderRequested=!1;mousePosition=null;isMouseDown=!1;columnWidthCache=new Map;rowHeightCache=new Map;isReordering=!1;errorRendered=!1;error=null;resizingColumn=null;resizingRow=null;reorderedColumn=null;reorderedRow=null;didReorder=!1;mouseDownPosition=null;mouseDownCell=null;requestNewRender(){this.renderRequested||(this.renderRequested=!0,requestAnimationFrame((()=>{this.renderRequested=!1,Je(this),a(this)})))}}function rt(e){if("spread-grid-context"in e)return;const t={"top-left":document.createElement("canvas"),"top-center":document.createElement("canvas"),"top-right":document.createElement("canvas"),"middle-left":document.createElement("canvas"),"middle-center":document.createElement("canvas"),"middle-right":document.createElement("canvas"),"bottom-left":document.createElement("canvas"),"bottom-center":document.createElement("canvas"),"bottom-right":document.createElement("canvas")},o=document.createElement("input"),n=document.createElement("div");e.setAttribute("tabindex","0"),e.setAttribute("style","max-width: 100vw; max-height: 100vh; overflow: auto; display: grid; position: relative; grid-template-columns: fit-content(0) fit-content(0) fit-content(0); grid-template-rows: fit-content(0) fit-content(0) fit-content(0); outline: none; user-select: none;"),e.classList.add("spread-grid"),t["top-left"].setAttribute("style","position: sticky; left: 0; top: 0; z-index: 2; grid-row: 1; grid-column: 1;"),t["top-center"].setAttribute("style","position: sticky; top: 0; z-index: 1; grid-row: 1; grid-column: 2;"),t["top-right"].setAttribute("style","position: sticky; right: 0; top: 0; z-index: 2; grid-row: 1; grid-column: 3;"),t["middle-left"].setAttribute("style","position: sticky; left: 0; z-index: 1; grid-row: 2; grid-column: 1;"),t["middle-center"].setAttribute("style","grid-row: 2; grid-column: 2; z-index: 0;"),t["middle-right"].setAttribute("style","position: sticky; right: 0; z-index: 1; grid-row: 2; grid-column: 3;"),t["bottom-left"].setAttribute("style","position: sticky; left: 0; bottom: 0; z-index: 2; grid-row: 3; grid-column: 1;"),t["bottom-center"].setAttribute("style","position: sticky; bottom: 0; z-index: 1; grid-row: 3; grid-column: 2;"),t["bottom-right"].setAttribute("style","position: sticky; right: 0; bottom: 0; z-index: 2; grid-row: 3; grid-column: 3;"),o.setAttribute("style","position: sticky; z-index: 3; outline: none; border: none; box-shadow: none; padding: 0 5px; font-size: 12px; font-family: Calibri; background-color: white; box-sizing: border-box; opacity: 0; pointer-events: none;"),n.setAttribute("style","pointer-events: none; background-color: white; color: black; border: 1px solid black; padding: 3px 7px; inset: unset; position: absolute; font-size: 12px; font-family: Calibri; "),n.setAttribute("popover","manual"),n.classList.add("spread-grid-tooltip");const r=new nt(e,t,o,n);function i(e,t,o){e.addEventListener(t,(e=>{try{o(e)}catch(e){e.message=`[${t} event]: ${e.message}`,r.error=e,r.requestNewRender()}}))}e["spread-grid-context"]=r;const d=e=>{o.value=e,o.dispatchEvent(new Event("input"))},c=e=>{const t=r.state.options.selectedCells,o=r.state.inputFormatResolver,n=r.state.columnLookup,i=r.state.rowLookup,l=r.state.text,s=r.state.isTextValid,c=r.state.options.onEditedCellsChange,a=r.state.options.onFiltersChange,h=u(t,o,n,i);if(""===l)return;if(!s)return;if(e&&!h.every((e=>e.edit.autoCommit)))return;const f=h.filter((e=>"DATA"===e.type)),p=h.filter((e=>"FILTER"===e.type));var m;m=f.map((e=>({...e.cell,value:e.edit.parse({string:l})}))),c(Qe(r.state.options.editedCells,m)),(e=>{a(Qe(tt(r.state.options.filters,"FILTER"),e))})(p.map((e=>({...e.cell,expression:e.edit.parse({string:l})})))),e||d("")},a=e=>{const t=r.state.options.selectedCells,o=r.state.options.onEditedCellsChange,n=r.state.options.onFiltersChange,i=u(t,r.state.inputFormatResolver,r.state.columnLookup,r.state.rowLookup);var l;e&&!i.every((e=>e.edit.autoCommit))||(l=t,o(Ze(r.state.options.editedCells,l)),(e=>{n(Ze(tt(r.state.options.filters,"FILTER"),e))})(t))};i(e,"scroll",(e=>{r.requestNewRender()})),i(e,"mouseenter",(e=>{r.mousePosition=et(e),r.requestNewRender()})),i(e,"mousemove",(t=>{if(r.mousePosition=et(t),r.resizingColumn){const t=r.state.columnLookup.get(l(r.resizingColumn)),o=t.width,n=t.right,i=de(e,r.mousePosition,r.state.fixedSize,r.state.totalSize),s=Math.max(10,i.x-n+o),u=r.state.options.columnWidths.filter((e=>l(e.columnId)!==t.key)).concat([{columnId:t.id,width:s}]);r.state.options.onColumnWidthsChange(u)}if(r.resizingRow){const t=r.state.rowLookup.get(l(r.resizingRow)),o=t.height,n=t.bottom,i=de(e,r.mousePosition,r.state.fixedSize,r.state.totalSize),s=Math.max(10,i.y-n+o),u=r.state.options.rowHeights.filter((e=>l(e.rowId)!==t.key)).concat([{rowId:t.id,height:s}]);r.state.options.onRowHeightsChange(u)}if(r.reorderedColumn){const t=r.state.columns,o=r.state.hoveredCell,n=de(e,r.mousePosition,r.state.fixedSize,r.state.totalSize),i=function(e,t,o,n){if(!o)return null;const r=ot(e,t,o.columnId);if(!r)return null;const[i,l]=r,s=l<=i?n.x<e[l].leftWithBorder+e[i].width?l:l+1:n.x>e[l].rightWithBorder-e[i].width?l:l-1;if(s===i)return null;const u=e.map((e=>e.id));return u.splice(i,1),u.splice(s,0,t),u}(t,r.reorderedColumn,o,n);i&&(r.didReorder=!0,r.isReordering=!0,r.state.options.onColumnsOrderChange(i))}if(r.reorderedRow){const t=r.state.rows,o=r.state.hoveredCell,n=de(e,r.mousePosition,r.state.fixedSize,r.state.totalSize),i=function(e,t,o,n){if(!o)return null;const r=ot(e,t,o.rowId);if(!r)return null;const[i,l]=r,s=l<=i?n.y<e[l].topWithBorder+e[i].height?l:l+1:n.y>e[l].bottomWithBorder-e[i].height?l:l-1;if(s===i)return null;const u=e.map((e=>e.id));return u.splice(i,1),u.splice(s,0,t),u}(t,r.reorderedRow,o,n);i&&(r.didReorder=!0,r.isReordering=!0,r.state.options.onRowsOrderChange(i))}r.requestNewRender()})),i(e,"mouseleave",(()=>{r.mousePosition=null,r.requestNewRender()})),i(e,"mousedown",(e=>{Je(r),d("");const t=r.state.hoveredCell;if(r.isMouseDown=!0,r.didReorder=!1,r.mouseDownPosition=r.mousePosition,r.mouseDownCell=t,r.state.resizableColumn&&(r.resizingColumn=r.state.resizableColumn),r.state.resizableRow&&(r.resizingRow=r.state.resizableRow),!r.resizingColumn&&t){const e=r.state.rowLookup.get(l(t.rowId));r.reorderedColumn="HEADER"===e.type?t.columnId:null}if(!r.resizingRow&&t){const e=r.state.columnLookup.get(l(t.columnId));r.reorderedRow="HEADER"===e.type?t.rowId:null}r.resizingColumn||r.resizingRow||r.state.options.onFocusedCellChange(t),e.ctrlKey||r.state.options.onSelectedCellsChange([]),r.requestNewRender()})),i(e,"mouseup",(e=>{Je(r),r.isMouseDown=!1,r.isReordering=!1,r.resizingColumn=null,r.resizingRow=null,r.reorderedColumn=null,r.reorderedRow=null,r.state.options.onSelectedCellsChange(Qe(r.state.options.selectedCells,r.state.highlightedCells)),r.requestNewRender()})),i(e,"pointerdown",(e=>{r.element.setPointerCapture(e.pointerId)})),i(e,"pointerup",(e=>{r.element.releasePointerCapture(e.pointerId)})),i(e,"click",(e=>{Je(r);const t=r.state.hoveredCell,o=r.mouseDownCell;if(r.state.resizableColumn||r.state.resizableRow)return;if(r.didReorder)return;if(null===t)return;if(null===o)return;if(l(t.columnId)!==l(o.columnId))return;if(l(t.rowId)!==l(o.rowId))return;const n=r.state.columnLookup.get(l(t.columnId)),i=r.state.rowLookup.get(l(t.rowId)),u=r.state.options.sortBy,d=r.state.inputFormatResolver.resolve(i,n),c={ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,button:e.button,buttons:e.buttons,detail:e.detail};if(d.edit?.toggle){const e=function(e,t,o,n){const r=n.hasValueByKey(o.key,t.key)?n.getValueByKey(o.key,t.key):e.value,i=e.edit.toggle;return"function"==typeof i?i({value:r}):i[(i.indexOf(r)+1)%i.length]}(d,n,i,r.state.edition),o=s(n,i);"DATA"===o&&r.state.options.onEditedCellsChange(Qe(r.state.options.editedCells,[{...t,value:e}])),"FILTER"===o&&r.state.options.onFiltersChange(Qe(tt(r.state.options.filters,"FILTER"),[{...t,expression:e}]))}else if("DATA"===n.type&&"DATA"===i.type)r.state.options.onCellClick({...r.state.hoveredCell,...c});else if("CUSTOM"===n.type||"CUSTOM"===i.type)r.state.options.onCustomCellClick({...r.state.hoveredCell,...c});else if("HEADER"===n.type||"HEADER"===i.type){const t=function(e,t,o,n){function r(e){const n="columnId"in e?e.columnId:"HEADER",r="rowId"in e?e.rowId:"HEADER";return t.key===l(n)&&o.key===l(r)}const i=["ASC","DESC",void 0],s=e.find(r),u=i.indexOf(s?.direction),d=i[(u+1)%i.length],c=e.indexOf(s)===e.length-1;return[...!n||!c&&s?e.filter((e=>!function(e){const n="columnId"in e?e.columnId:"HEADER",r="rowId"in e?e.rowId:"HEADER";return"HEADER"===t.type&&t.key===l(n)||"HEADER"===o.type&&o.key===l(r)}(e))):e.filter((e=>!r(e))),...d?[{columnId:t.id,rowId:o.id,direction:d}]:[]]}(u,n,i,e.ctrlKey);r.state.options.onSortByChange(t),r.state.options.onSelectedCellsChange([])}})),i(e,"dblclick",(e=>{if(Je(r),r.state.resizableColumn){const e=l(r.state.resizableColumn),t=r.state.options.columnWidths.filter((t=>l(t.columnId)!==e));r.state.options.onColumnWidthsChange(t),r.columnWidthCache.delete(e)}if(r.state.resizableRow){const e=l(r.state.resizableRow),t=r.state.options.rowHeights.filter((t=>l(t.rowId)!==e));r.state.options.onRowHeightsChange(t),r.rowHeightCache.delete(e)}const t=r.state.focusedCell;if(null===t)return;const n=l(t.columnId),i=l(t.rowId),s=r.state.columnLookup,u=r.state.rowLookup,c=r.state.inputFormatResolver;if(!s.has(n))return;if(!u.has(i))return;const a=s.get(n),h=u.get(i),f=c.resolve(h,a),p=f.text;f.edit&&(f.edit.toggle||(d(p),o?.select()))})),i(e,"focus",(()=>{o.parentElement&&o.focus({preventScroll:!0})})),i(e,"keydown",(e=>{Je(r);const t=r.state.focusedCell,o=r.state.columnLookup,n=r.state.rowLookup,i=r.state.options.selectedCells,s=r.state.options.onSelectedCellsChange,u=r.state.options.onFocusedCellChange,h=r.state.options.editedCells,f=r.state.options.onEditedCellsChange,p=r.state.columns,m=r.state.rows,g=r.state.text,y=r.state.inputFormatResolver,w=(e,t)=>{u(e),t.shiftKey?s(Qe(i,[e])):s([e])},x=(e,n)=>{if(!t)return;const r=l(t.columnId);if(!o.has(r))return;const i=o.get(r).index,s=Math.max(0,Math.min(p.length-1,i+e));if(s===i)return;const u={rowId:t.rowId,columnId:p[s].id};w(u,n)},b=(e,o)=>{if(!t)return;const r=l(t.rowId);if(!n.has(r))return;const i=n.get(r).index,s=Math.max(0,Math.min(m.length-1,i+e));if(s===i)return;const u={rowId:m[s].id,columnId:t.columnId};w(u,o)},R=()=>{e.preventDefault(),e.stopPropagation()};switch(e.key){case"Escape":""!==g?d(""):i.length>1?s([t]):h.length>0?f([]):(u(null),s([]));break;case"Enter":c(!1);break;case"ArrowUp":R(),b(e.ctrlKey?-m.length:-1,e);break;case"ArrowDown":R(),b(e.ctrlKey?m.length:1,e);break;case"ArrowLeft":R(),x(e.ctrlKey?-p.length:-1,e);break;case"ArrowRight":R(),x(e.ctrlKey?p.length:1,e);break;case"Delete":case"Backspace":a(!1);break;case"c":(e=>{if(!e.ctrlKey)return;const t=function(e,t,o,n){const r=new Map(t.map((e=>[e.key,e]))),i=new Map(o.map((e=>[e.key,e]))),s=e.map((e=>({columnKey:l(e.columnId),rowKey:l(e.rowId)}))).filter((e=>r.has(e.columnKey)&&i.has(e.rowKey))),u=new Set(s.map((e=>e.columnKey))),d=new Set(s.map((e=>e.rowKey)));if(0===s.length)return"";const c=new A(e),a=Math.min(...s.map((e=>r.get(e.columnKey).index))),h=Math.max(...s.map((e=>r.get(e.columnKey).index))),f=Math.min(...s.map((e=>i.get(e.rowKey).index))),p=Math.max(...s.map((e=>i.get(e.rowKey).index))),m=[];for(let e=f;e<=p;e++){const r=o[e],i=r.key;if(d.has(i)){for(let e=a;e<=h;e++){const o=t[e],l=o.key;if(u.has(l)){if(c.isKeySelected(i,l)){const e=n.resolve(r,o).text;m.push(e)}e<h&&m.push("\t")}}e<p&&m.push("\n")}}return m.join("")}(i,p,m,y);if(navigator.clipboard)navigator.clipboard.writeText(t);else{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}})(e)}})),new ResizeObserver((()=>{r.requestNewRender()})).observe(e),i(o,"input",(e=>{Je(r),o.value?(c(!0),o.style.opacity="1",o.style.pointerEvents="auto"):(e.isTrusted&&a(!0),o.style.opacity="0",o.style.pointerEvents="none")})),i(o,"click",(e=>{e.stopPropagation()})),i(o,"dblclick",(e=>{e.stopPropagation()})),i(o,"mousedown",(e=>{e.stopPropagation()})),i(o,"keydown",(e=>{switch(e.key){case"Enter":case"Escape":break;case"Delete":case"Backspace":case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":""!==o.value&&(e.stopPropagation(),r.requestNewRender());break;default:e.stopPropagation(),r.requestNewRender()}}))}function it(e){const[t,o]=(0,n.useState)(null);return t&&function(e,t){rt(e);const o=e["spread-grid-context"];o.externalOptions=t,null===o.state?(Je(o),a(o)):o.requestNewRender()}(t,e),n.default.createElement("div",{ref:o})}var lt=o.A;export{lt as default};